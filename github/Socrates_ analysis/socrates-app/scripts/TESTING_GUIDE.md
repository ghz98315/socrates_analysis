# 功能测试执行指南

> 测试日期: 2026-02-14
> 目标: 验证核心功能正常工作

---

## 测试环境

- **开发服务器**: http://localhost:3000
- **网络地址**: http://192.168.3.2:3000
- **数据库**: 已迁移完成 (parent_id, phone, role constraint)

---

## 准备测试账号

### 方式 1: 使用现有账号

如果有测试账号，直接使用。如果没有，需要先注册。

### 方式 2: 注册新账号

| 类型 | 邮箱 | 密码 | 用于 |
|------|------|------|------|
| 家长 | parent-test@example.com | test123456 | Dashboard 测试 |
| 学生 | student-test@example.com | test123456 | Workbench 测试 |

---

## 测试场景

### 场景 A: 家长登录和 Dashboard (P0-2)

#### A1: 家长登录
```
1. 访问 http://localhost:3000/login
2. 输入家长邮箱和密码
3. 点击"登录"按钮
4. 检查是否跳转到 /select-profile
```

**预期结果**:
- [ ] 登录成功，跳转到角色选择页
- [ ] 显示 Junior/Senior/Parent 三个选项

**实际结果**: _______

**失败原因**: _______

---

#### A2: 家长角色选择
```
1. 在 /select-profile 选择 "Parent"
2. 点击 "Continue"
```

**预期结果**:
- [ ] 跳转到 /dashboard
- [ ] profile.role 更新为 'parent'

**实际结果**: _______

---

#### A3: 家长 Dashboard 访问
```
1. 确认进入 /dashboard 页面
2. 检查学生选择器是否显示
3. 检查"添加学生"按钮
```

**预期结果**:
- [ ] 显示"选择查看学生报告"
- [ ] 显示"添加学生"按钮
- [ ] 显示"退出"按钮

**实际结果**: _______

---

### 场景 B: 学生上传错题和保存 (P0-3)

#### B1: 学生登录
```
1. 访问 http://localhost:3000/login
2. 输入学生邮箱和密码
3. 点击"登录"按钮
4. 检查是否跳转到 /select-profile
```

**预期结果**:
- [ ] 登录成功，跳转到角色选择页
- [ ] 显示 Junior/Senior 两个学生选项

**实际结果**: _______

**失败原因**: _______

---

#### B2: 学生角色选择
```
1. 在 /select-profile 选择 "Junior"
2. 点击 "Continue"
```

**预期结果**:
- [ ] 跳转到 /workbench
- [ ] profile.role 更新为 'student'
- [ ] theme_preference 设置为 'junior'

**实际结果**: _______

---

#### B3: 学生工作台访问
```
1. 确认进入 /workbench 页面
2. 检查页面布局是否正确
3. 检查学习计时器
```

**预期结果**:
- [ ] 左侧显示图片上传区域
- [ ] 右侧显示 AI 对话区域
- [ ] 顶部显示学习计时器

**实际结果**: _______

---

#### B4: 错题图片上传
```
1. 点击左侧图片上传区域
2. 选择一张包含错题的图片
3. 检查图片预览
```

**预期结果**:
- [ ] 图片显示在预览区域
- [ ] 开始 OCR 处理
- [ ] 显示处理进度

**实际结果**: _______

**OCR 编码问题验证**:
- [ ] 中文文字显示正常（无乱码）
- [ ] 数学符号显示正常

---

#### B5: 错题识别确认
```
1. OCR 完成后，检查识别结果
2. 如有误，可以手动修改
3. 点击"确认"按钮
```

**预期结果**:
- [ ] 识别的文字可以编辑
- [ ] 点击确认后跳转到聊天界面
- [ ] 创建 error_session 记录

**实际结果**: _______

---

### 场景 C: 家长添加学生功能 (P0-4)

#### C1: 打开添加学生模态框
```
1. 以家长身份登录
2. 进入 /dashboard
3. 点击"添加学生"按钮
```

**预期结果**:
- [ ] 显示添加学生模态框
- [ ] 表单包含：姓名、邮箱、密码、年级
- [ ] 显示"添加学生"按钮

**实际结果**: _______

---

#### C2: 填写学生信息
```
1. 填写测试学生信息：
   - 姓名: 测试学生A
   - 邮箱: student-a@example.com
   - 密码: test123456
   - 年级: 三年级
```

**预期结果**:
- [ ] 表单验证通过
- [ ] "添加学生"按钮可点击

**实际结果**: _______

---

#### C3: 提交添加学生
```
1. 点击"添加学生"按钮
2. 等待 API 响应
3. 检查响应消息
```

**预期结果**:
- [ ] API 调用成功
- [ ] 显示成功提示
- [ ] 模态框关闭
- [ ] 学生列表刷新

**实际结果**: _______

---

#### C4: 验证学生创建
```sql
-- 验证新创建的学生账号
SELECT
  p.id,
  p.display_name,
  p.email,
  p.phone,
  p.role,
  p.parent_id,
  p.grade_level,
  p.created_at
FROM profiles p
WHERE p.role = 'student'
  AND p.created_at >= '2026-02-14'
ORDER BY p.created_at DESC
LIMIT 5;
```

**预期结果**:
- [ ] 新学生记录存在
- [ ] role = 'student'
- [ ] parent_id 指向正确的家长
- [ ] phone 字段已保存

**实际结果**: _______

---

## 测试执行记录

### 场景 A: 家长登录和 Dashboard
- [ ] A1: 家长登录
- [ ] A2: 家长角色选择
- [ ] A3: 家长 Dashboard 访问

### 场景 B: 学生上传错题和保存
- [ ] B1: 学生登录
- [ ] B2: 学生角色选择
- [ ] B3: 学生工作台访问
- [ ] B4: 错题图片上传
- [ ] B5: 错题识别确认

### 场景 C: 家长添加学生功能
- [ ] C1: 打开添加学生模态框
- [ ] C2: 填写学生信息
- [ ] C3: 提交添加学生
- [ ] C4: 验证学生创建

---

## 发现的问题

| 问题 ID | 描述 | 严重程度 | 状态 |
|--------|------|----------|------|
| | | | |

---

## 测试完成清单

- [ ] 场景 A 测试完成
- [ ] 场景 B 测试完成
- [ ] 场景 C 测试完成
- [ ] 所有测试通过
- [ ] 发现的问题已记录

---

## 下一步

测试完成后：
- [ ] 修复所有发现的问题
- [ ] 更新测试报告
- [ ] 提交代码变更
- [ ] 开始 P1 任务

---

## 附加说明

1. **浏览器控制台检查**:
   - 按 F12 打开开发者工具
   - 查看 Console 和 Network 标签
   - 检查是否有 JavaScript 错误

2. **网络请求检查**:
   - 查看 API 调用是否成功
   - 检查响应状态码
   - 检查返回数据格式

3. **数据库检查**:
   - 在 Supabase SQL Editor 中执行验证查询
   - 确认数据正确保存
